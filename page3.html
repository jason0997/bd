<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>照片播放器与“寿”字</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #FFFFFF;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
            flex-direction: column;
            gap: 20px;
        }
        
        #loading-text {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #slideshow-container {
            width: 100vw;
            height: calc(100vh - 80px);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            top: 0;
            left: 0;
            transition: opacity 1s ease-in-out;
            background-color: transparent;
            opacity: 0; /* 初始隐藏 */
        }

        .slideshow-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: opacity 0.8s ease-in-out;
        }

        .slideshow-image.active {
            opacity: 1;
            z-index: 2;
        }

        .slideshow-image.inactive {
            opacity: 0;
            z-index: 1;
        }

        #shou-character-grid-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: grid;
            gap: 1px;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            background-color: transparent;
            padding: 10px;
            box-sizing: border-box;
            overflow: auto;
        }

        .grid-cell {
            width: 100%;
            height: 100%;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: 4px;
        }

        .grid-cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }

        #controls {
            position: relative;
            width: 100%;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 20px;
            box-sizing: border-box;
            z-index: 10;
        }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div id="loading-text">正在加载照片...</div>
        <div class="spinner"></div>
    </div>

    <div id="slideshow-container" class="rounded-lg shadow-xl">
        <img id="slideshow-image-1" class="slideshow-image rounded-lg" alt="Slideshow Image">
        <img id="slideshow-image-2" class="slideshow-image rounded-lg" alt="Slideshow Image">
    </div>

    <div id="controls">
        <button id="jump-button" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
            跳转到第17张
        </button>
    </div>

    <div id="shou-character-grid-container" class="rounded-lg shadow-xl">
        </div>

    <script>
        const slideshowContainer = document.getElementById('slideshow-container');
        const shouGridContainer = document.getElementById('shou-character-grid-container');
        const jumpButton = document.getElementById('jump-button');
        const loadingOverlay = document.getElementById('loading-overlay');

        const slideshowImage1 = document.getElementById('slideshow-image-1');
        const slideshowImage2 = document.getElementById('slideshow-image-2');

        let activeImageElement = slideshowImage1;
        let inactiveImageElement = slideshowImage2;

        const imageUrls = [
            './img/1.jpeg',
            './img/2.jpeg',
            './img/3.jpeg',
            './img/4.jpeg',
            './img/5.jpeg',
            './img/6.jpeg',
            './img/7.jpeg',
            './img/8.jpeg',
            './img/9.jpeg',
            './img/10.jpeg',
            './img/11.jpeg',
            './img/12.jpeg',
            './img/13.jpeg',
            './img/14.jpeg',
            './img/15.jpeg',
            './img/16.jpeg',
            './img/17.jpeg',
            './img/18.jpeg'
        ];

        let currentImageIndex = 0;
        let slideshowCounter = 0;
        const totalSlides = imageUrls.length;
        const displayDuration = 2000;
        const fadeDuration = 800;

        const shouPixelMap = `
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000110000000000000000000000000
00000000000000000000001110000000000000000000000000
00000000000000000000001110000000000000000000000000
00000000001111111111111111111111111111110000000000
00000000001111111111111111111111111111110000000000
00000000000000000000001110000000000000000000000000
00000000000000000000001100000000000000000000000000
00000000000000000000001100000000000000000000000000
00000000000000000000011110000000000000000000000000
00000000000111111111111111111111111111000000000000
00000000000011111111111111111111111111000000000000
00000000000000000000011000000000000000000000000000
00000000000000000000011000000000000000000000000000
00000000000000000000111000000000000000000000000000
00000000111111111111111111111111111111111100000000
00000000111111111111111111111111111111111100000000
00000000000000000001110000000000111000000000000000
00000000000000000001100000000000110000000000000000
00000000000000000011100000000000110000000000000000
00000000000000000111000000000000110000000000000000
00000000000000000111000000000000111000000000000000
00000000000000001111111111111111111111111000000000
00000000000000011111111111111111111111111000000000
00000000000000111100000000000000111000000000000000
00000000000000111000000000000000110000000000000000
00000000000011110000000000000000110000000000000000
00000000000111100001000000000000110000000000000000
00000000001111000011110000000000110000000000000000
00000000111110000000111100000000110000000000000000
00000001111000000000001111000000110000000000000000
00000000110000000000000111000000110000000000000000
00000000000000000000000000000000110000000000000000
00000000000000000000000000000000110000000000000000
00000000000000000000000000100001110000000000000000
00000000000000000000000000111111110000000000000000
00000000000000000000000000011110000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000`.trim();

        const shouRows = shouPixelMap.split('\n').map(row => row.trim());
        const shouHeight = shouRows.length;
        const shouWidth = shouRows[0].length;

        function showNextImage() {
            if (slideshowCounter >= totalSlides - 1) {
                clearInterval(slideshowInterval);
                setTimeout(transitionToShouCharacter, displayDuration - fadeDuration);
                return;
            }

            slideshowCounter++;
            let nextImageToDisplayIndex = (currentImageIndex + 1) % totalSlides;
            inactiveImageElement.src = imageUrls[nextImageToDisplayIndex];

            activeImageElement.classList.remove('active');
            activeImageElement.classList.add('inactive');

            inactiveImageElement.classList.remove('inactive');
            inactiveImageElement.classList.add('active');

            const temp = activeImageElement;
            activeImageElement = inactiveImageElement;
            inactiveImageElement = temp;

            currentImageIndex = nextImageToDisplayIndex;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function transitionToShouCharacter() {
            slideshowContainer.style.opacity = 0;
            jumpButton.style.display = 'none';

            const viewportWidth = window.innerWidth;
            const desiredGridWidth = viewportWidth * 0.95;
            const cellSize = Math.floor(desiredGridWidth / shouWidth);

            shouGridContainer.style.gridTemplateColumns = `repeat(${shouWidth}, ${cellSize}px)`;
            shouGridContainer.style.gridAutoRows = `${cellSize}px`;
            shouGridContainer.style.width = `${shouWidth * cellSize}px`;
            shouGridContainer.style.height = `${shouHeight * cellSize}px`;
            shouGridContainer.style.position = 'absolute';
            shouGridContainer.style.left = '50%';
            shouGridContainer.style.top = '50%';
            shouGridContainer.style.transform = 'translate(-50%, -50%)';

            const cellsToReveal = [];

            for (let r = 0; r < shouHeight; r++) {
                for (let c = 0; c < shouWidth; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    if (shouRows[r][c] === '1') {
                        const randomImageIndex = Math.floor(Math.random() * imageUrls.length);
                        const img = document.createElement('img');
                        img.src = imageUrls[randomImageIndex];
                        img.alt = `寿字图片 ${r}-${c}`;
                        cell.appendChild(img);
                        cellsToReveal.push({ img: img, row: r, col: c });
                    }
                    shouGridContainer.appendChild(cell);
                }
            }

            setTimeout(() => {
                slideshowContainer.style.display = 'none';
                shouGridContainer.style.opacity = 1;

                const revealStartDelay = 200;
                const revealStaggerDelay = 15;

                shuffleArray(cellsToReveal);

                cellsToReveal.forEach((cellData, index) => {
                    setTimeout(() => {
                        cellData.img.style.opacity = 1;
                    }, revealStartDelay + (index * revealStaggerDelay));
                });

            }, 1000);
        }

        let slideshowInterval;

        function setSlideshowImageDirectly(index) {
            activeImageElement.classList.remove('active');
            activeImageElement.classList.add('inactive');

            inactiveImageElement.src = imageUrls[index];
            inactiveImageElement.classList.remove('inactive');
            inactiveImageElement.classList.add('active');

            const temp = activeImageElement;
            activeImageElement = inactiveImageElement;
            inactiveImageElement = temp;
        }

        /**
         * 预加载所有图片
         * @param {string[]} urls - 要加载的图片URL数组
         * @param {Function} callback - 所有图片加载完成后的回调函数
         */
        function preloadImages(urls, callback) {
            let loadedCount = 0;
            const total = urls.length;

            if (total === 0) {
                callback();
                return;
            }

            urls.forEach(url => {
                const img = new Image();
                img.onload = () => {
                    loadedCount++;
                    if (loadedCount === total) {
                        callback();
                    }
                };
                img.onerror = () => {
                    loadedCount++;
                    console.error(`图片加载失败: ${url}`);
                    if (loadedCount === total) {
                        callback();
                    }
                };
                img.src = url;
            });
        }

        function startSlideshow() {
            loadingOverlay.style.opacity = 0;
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                slideshowContainer.style.opacity = 1; // 淡入幻灯片容器

                activeImageElement.src = imageUrls[0];
                activeImageElement.classList.add('active');

                inactiveImageElement.classList.add('inactive');

                currentImageIndex = 0;
                slideshowCounter = 0;

                slideshowInterval = setInterval(showNextImage, displayDuration);
            }, 500); // 等待淡出动画完成
        }

        window.onload = function() {
            preloadImages(imageUrls, startSlideshow);
        };

        jumpButton.addEventListener('click', () => {
            clearInterval(slideshowInterval);

            const jumpToIndex = 16;

            setSlideshowImageDirectly(jumpToIndex);
            currentImageIndex = jumpToIndex;
            slideshowCounter = jumpToIndex;

            if (currentImageIndex === totalSlides - 1) {
                setTimeout(transitionToShouCharacter, displayDuration - fadeDuration);
            } else {
                slideshowInterval = setInterval(showNextImage, displayDuration);
            }
        });

        window.addEventListener('resize', () => {
            if (shouGridContainer.style.opacity === '1') {
                const viewportWidth = window.innerWidth;
                const desiredGridWidth = viewportWidth * 0.95;
                const cellSize = Math.floor(desiredGridWidth / shouWidth);

                shouGridContainer.style.gridTemplateColumns = `repeat(${shouWidth}, ${cellSize}px)`;
                shouGridContainer.style.gridAutoRows = `${cellSize}px`;
                shouGridContainer.style.width = `${shouWidth * cellSize}px`;
                shouGridContainer.style.height = `${shouHeight * cellSize}px`;
            }
        });
    </script>
</body>
</html>