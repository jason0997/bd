<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>照片播放器与“寿”字</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* 防止过渡期间出现滚动条 */
            background-color: #FFFFFF; /* 背景改为白色 */
            display: flex;
            flex-direction: column; /* 垂直布局，便于放置按钮 */
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* 全屏高度 */
        }

        #slideshow-container {
            width: 100vw;
            height: calc(100vh - 80px); /* 为按钮留出空间 */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; /* 相对定位，便于子元素绝对定位 */
            top: 0;
            left: 0;
            transition: opacity 1s ease-in-out; /* 容器淡出效果 */
            background-color: transparent; /* 改为透明，透出白色body背景 */
        }

        /* 用于交替显示的图片元素 */
        .slideshow-image {
            position: absolute; /* 绝对定位，使两张图片可以重叠 */
            width: 100%;
            height: 100%;
            object-fit: contain; /* 确保图片完整显示，不裁剪 */
            transition: opacity 0.8s ease-in-out; /* 图片淡入淡出过渡 */
        }

        /* 当前显示图片的样式 */
        .slideshow-image.active {
            opacity: 1; /* 完全不透明 */
            z-index: 2; /* 确保在上方 */
        }

        /* 准备显示或已隐藏图片的样式 */
        .slideshow-image.inactive {
            opacity: 0; /* 完全透明 */
            z-index: 1; /* 确保在下方 */
        }

        #shou-character-grid-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: grid;
            gap: 1px; /* 图片单元格之间的细小间隙 */
            opacity: 0; /* 初始隐藏，稍后整体淡入 */
            transition: opacity 1s ease-in-out; /* 整体淡入效果 */
            background-color: transparent; /* 背景改为透明 */
            padding: 10px; /* 网格周围的内边距 */
            box-sizing: border-box; /* 包含内边距在宽度/高度计算中 */
            overflow: auto; /* 网格过大时允许滚动 */
        }

        .grid-cell {
            width: 100%; /* 每个单元格占据其网格区域的全部宽度 */
            height: 100%; /* 每个单元格占据其网格区域的全部高度 */
            background-color: transparent; /* 空白单元格的背景改为透明 */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: 4px; /* 网格单元格圆角 */
        }

        .grid-cell img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 图片填充单元格区域 */
            border-radius: 4px;
            opacity: 0; /* 初始隐藏，通过JS和CSS逐个淡入 */
            transition: opacity 0.3s ease-out; /* 单个图片淡入的过渡效果 */
        }

        #controls {
            position: relative;
            width: 100%;
            height: 80px; /* 留出底部空间 */
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 20px;
            box-sizing: border-box;
            z-index: 10; /* 确保按钮在幻灯片之上 */
        }
    </style>
</head>
<body>

    <div id="slideshow-container" class="rounded-lg shadow-xl">
        <img id="slideshow-image-1" class="slideshow-image rounded-lg" alt="Slideshow Image">
        <img id="slideshow-image-2" class="slideshow-image rounded-lg" alt="Slideshow Image">
    </div>

    <div id="controls">
        <button id="jump-button" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
            跳转到第17张
        </button>
    </div>

    <div id="shou-character-grid-container" class="rounded-lg shadow-xl">
        <!-- '寿'字图片网格将通过 JavaScript 动态生成 -->
    </div>

    <script>
        const slideshowContainer = document.getElementById('slideshow-container');
        const shouGridContainer = document.getElementById('shou-character-grid-container');
        const jumpButton = document.getElementById('jump-button');

        // 获取两张图片元素
        const slideshowImage1 = document.getElementById('slideshow-image-1');
        const slideshowImage2 = document.getElementById('slideshow-image-2');

        // 跟踪当前活动的图片元素（正在显示或将要显示）和非活动的图片元素（背景或将要隐藏）
        let activeImageElement = slideshowImage1;
        let inactiveImageElement = slideshowImage2;

        // Placeholder image URLs (请替换为你的18张实际图片链接)
        const imageUrls = [
            './img/1.jpeg',
            './img/2.jpeg',
            './img/3.jpeg',
            'https://placehold.co/800x600/FF33A1/FFFFFF?text=Photo+4',
            'https://placehold.co/800x600/A133FF/FFFFFF?text=Photo+5',
            'https://placehold.co/800x600/FFDD33/FFFFFF?text=Photo+6',
            'https://placehold.co/800x600/33FFF1/FFFFFF?text=Photo+7',
            'https://placehold.co/800x600/F133FF/FFFFFF?text=Photo+8',
            'https://placehold.co/800x600/33FF8D/FFFFFF?text=Photo+9',
            'https://placehold.co/800x600/8D33FF/FFFFFF?text=Photo+10',
            'https://placehold.co/800x600/FF3357/FFFFFF?text=Photo+11',
            'https://placehold.co/800x600/57FF33/FFFFFF?text=Photo+12',
            'https://placehold.co/800x600/33A1FF/FFFFFF?text=Photo+13',
            'https://placehold.co/800x600/A1FF33/FFFFFF?text=Photo+14',
            'https://placehold.co/800x600/FF8D33/FFFFFF?text=Photo+15',
            'https://placehold.co/800x600/8DFF33/FFFFFF?text=Photo+16',
            'https://placehold.co/800x600/3357A1/FFFFFF?text=Photo+17',
            'https://placehold.co/800x600/A13357/FFFFFF?text=Photo+18'
        ];

        let currentImageIndex = 0; // 当前正在显示的图片索引
        let slideshowCounter = 0; // 已经完成过渡的图片数量计数
        const totalSlides = imageUrls.length; // 总图片数量
        const displayDuration = 2000; // 每张照片停顿2秒
        const fadeDuration = 800; // 渐变动画时间0.8秒 (与CSS同步)

        // 像素坐标系，形成“寿”字
        // '1' 表示该位置需要放置一张图片，'0' 表示为空
        const shouPixelMap = `
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000110000000000000000000000000
00000000000000000000001110000000000000000000000000
00000000000000000000001110000000000000000000000000
00000000001111111111111111111111111111110000000000
00000000001111111111111111111111111111110000000000
00000000000000000000001110000000000000000000000000
00000000000000000000001100000000000000000000000000
00000000000000000000001100000000000000000000000000
00000000000000000000011110000000000000000000000000
00000000000111111111111111111111111111000000000000
00000000000011111111111111111111111111000000000000
00000000000000000000011000000000000000000000000000
00000000000000000000011000000000000000000000000000
00000000000000000000111000000000000000000000000000
00000000111111111111111111111111111111111100000000
00000000111111111111111111111111111111111100000000
00000000000000000001110000000000111000000000000000
00000000000000000001100000000000110000000000000000
00000000000000000011100000000000110000000000000000
00000000000000000111000000000000110000000000000000
00000000000000000111000000000000111000000000000000
00000000000000001111111111111111111111111000000000
00000000000000011111111111111111111111111000000000
00000000000000111100000000000000111000000000000000
00000000000000111000000000000000110000000000000000
00000000000011110000000000000000110000000000000000
00000000000111100001000000000000110000000000000000
00000000001111000011110000000000110000000000000000
00000000111110000000111100000000110000000000000000
00000001111000000000001111000000110000000000000000
00000000110000000000000111000000110000000000000000
00000000000000000000000000000000110000000000000000
00000000000000000000000000000000110000000000000000
00000000000000000000000000100001110000000000000000
00000000000000000000000000111111110000000000000000
00000000000000000000000000011110000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000`.trim();

        // 将 shouRows, shouHeight, shouWidth 声明移到此处，使其成为全局变量
        const shouRows = shouPixelMap.split('\n').map(row => row.trim());
        const shouHeight = shouRows.length;
        const shouWidth = shouRows[0].length;

        /**
         * 显示下一张图片，并实现交叉渐变效果。
         */
        function showNextImage() {
            // 如果已经完成了所有图片的播放（即当前是第18次过渡，从第18张图片过渡走），
            // 则停止幻灯片并过渡到“寿”字。
            if (slideshowCounter === totalSlides - 1) { // 如果当前是第17次过渡完成，意味着第18张图片正在显示
                clearInterval(slideshowInterval); // 停止自动播放
                // 在第18张照片显示一段时间后，启动向“寿”字的过渡
                setTimeout(transitionToShouCharacter, displayDuration - fadeDuration);
                return; // 结束函数，不再加载下一张图片
            }

            // 增加计数器，表示即将开始一次新的图片过渡
            slideshowCounter++;

            // 计算下一张要显示的图片索引
            let nextImageToDisplayIndex = (currentImageIndex + 1) % totalSlides;

            // 将新图片加载到目前处于非活动状态的图片元素中
            inactiveImageElement.src = imageUrls[nextImageToDisplayIndex];

            // 触发交叉渐变动画：当前活动图片淡出，新图片淡入
            activeImageElement.classList.remove('active');
            activeImageElement.classList.add('inactive'); // 旧图片开始淡出

            inactiveImageElement.classList.remove('inactive');
            inactiveImageElement.classList.add('active'); // 新图片开始淡入

            // 交换 activeImageElement 和 inactiveImageElement 的引用，为下一次循环做准备
            const temp = activeImageElement;
            activeImageElement = inactiveImageElement;
            inactiveImageElement = temp;

            // 更新当前活跃图片的索引
            currentImageIndex = nextImageToDisplayIndex;
        }

        /**
         * 随机打乱数组的顺序（Fisher-Yates 洗牌算法）。
         * @param {Array} array 待打乱的数组。
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // 交换元素
            }
        }

        /**
         * 过渡到“寿”字网格显示。
         */
        function transitionToShouCharacter() {
            slideshowContainer.style.opacity = 0; // 淡出幻灯片容器
            jumpButton.style.display = 'none'; // 隐藏跳转按钮

            // 根据屏幕尺寸计算每个单元格的大小，以确保“寿”字网格自适应屏幕并居中
            const viewportWidth = window.innerWidth;
            const desiredGridWidth = viewportWidth * 0.95; // 网格占据视口宽度的95%
            const cellSize = Math.floor(desiredGridWidth / shouWidth);

            shouGridContainer.style.gridTemplateColumns = `repeat(${shouWidth}, ${cellSize}px)`;
            shouGridContainer.style.gridAutoRows = `${cellSize}px`;
            shouGridContainer.style.width = `${shouWidth * cellSize}px`;
            shouGridContainer.style.height = `${shouHeight * cellSize}px`;
            shouGridContainer.style.position = 'absolute';
            shouGridContainer.style.left = '50%';
            shouGridContainer.style.top = '50%';
            shouGridContainer.style.transform = 'translate(-50%, -50%)'; // 居中网格

            const cellsToReveal = []; // 存储所有需要被显示的小图片元素及其位置信息

            // 遍历“寿”字像素图，动态生成图片或空白单元格
            for (let r = 0; r < shouHeight; r++) {
                for (let c = 0; c < shouWidth; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    if (shouRows[r][c] === '1') {
                        // 如果像素点为1，则随机选择一张照片填充
                        const randomImageIndex = Math.floor(Math.random() * imageUrls.length);
                        const img = document.createElement('img');
                        img.src = imageUrls[randomImageIndex];
                        img.alt = `寿字图片 ${r}-${c}`;
                        // 注意：这里不再设置 img.style.opacity = 0; 因为CSS已经处理了初始隐藏
                        cell.appendChild(img);
                        cellsToReveal.push({ img: img, row: r, col: c }); // 收集图片元素用于后续的逐个显示
                    }
                    shouGridContainer.appendChild(cell);
                }
            }

            // 等待幻灯片容器完全淡出后，淡入“寿”字网格，然后开始逐个显示图片
            setTimeout(() => {
                slideshowContainer.style.display = 'none'; // 完全隐藏幻灯片容器
                shouGridContainer.style.opacity = 1; // 淡入“寿”字网格的整体容器

                // 开始逐个显示小图片
                const revealStartDelay = 200; // 在网格容器整体淡入后，延迟多久开始显示小图片
                const revealStaggerDelay = 15; // 每张小图片之间显示的延迟

                // 随机打乱要显示的小图片顺序
                shuffleArray(cellsToReveal);

                cellsToReveal.forEach((cellData, index) => {
                    setTimeout(() => {
                        cellData.img.style.opacity = 1; // 设置图片透明度为1，触发CSS的淡入过渡
                    }, revealStartDelay + (index * revealStaggerDelay));
                });

            }, 1000); // 与 slideshowContainer 的 transition 时间一致
        }

        let slideshowInterval; // 自动播放的定时器

        /**
         * 直接设置幻灯片显示指定索引的图片，不影响计数器和定时器。
         * 用于跳转功能。
         * @param {number} index 要显示的图片索引。
         */
        function setSlideshowImageDirectly(index) {
            // 将当前活跃的图片设置为非活跃（淡出）
            activeImageElement.classList.remove('active');
            activeImageElement.classList.add('inactive');

            // 将要显示的新图片加载到当前非活跃的元素中，并设置为活跃（淡入）
            inactiveImageElement.src = imageUrls[index];
            inactiveImageElement.classList.remove('inactive');
            inactiveImageElement.classList.add('active');

            // 交换 activeImageElement 和 inactiveImageElement 的引用
            const temp = activeImageElement;
            activeImageElement = inactiveImageElement;
            inactiveImageElement = temp;
        }

        // 页面加载完成时执行初始化
        window.onload = function() {
            // 初始设置：第一张图片显示
            activeImageElement.src = imageUrls[0]; // 加载第一张图片 (Photo 1)
            activeImageElement.classList.add('active'); // 设置为活动状态

            // 另一张图片元素初始化为非活动状态，准备加载下一张图片
            inactiveImageElement.classList.add('inactive');

            currentImageIndex = 0; // 当前显示的图片索引为0 (Photo 1)
            slideshowCounter = 0; // 初始时，未完成任何图片间的过渡

            // 启动自动播放，在 displayDuration 后第一次调用 showNextImage
            slideshowInterval = setInterval(showNextImage, displayDuration);
        };

        // 跳转按钮点击事件处理
        jumpButton.addEventListener('click', () => {
            clearInterval(slideshowInterval); // 停止当前的自动播放

            const jumpToIndex = 16; // 目标是第17张照片，数组索引为16

            setSlideshowImageDirectly(jumpToIndex); // 立即显示第17张照片
            currentImageIndex = jumpToIndex; // 更新当前显示的图片索引
            slideshowCounter = jumpToIndex; // 更新计数器，表示已经“完成”了到这张图片的过渡

            // 如果跳转到的就是第18张照片（索引为17），则直接启动向“寿”字的过渡
            if (currentImageIndex === totalSlides - 1) {
                 setTimeout(transitionToShouCharacter, displayDuration - fadeDuration);
            } else {
                // 否则，从当前跳转的图片开始，继续自动播放
                slideshowInterval = setInterval(showNextImage, displayDuration);
            }
        });

        // 调整窗口大小时重新计算网格尺寸
        window.addEventListener('resize', () => {
            if (shouGridContainer.style.opacity === '1') { // 只有在“寿”字显示时才调整
                const viewportWidth = window.innerWidth;
                const desiredGridWidth = viewportWidth * 0.95;
                const cellSize = Math.floor(desiredGridWidth / shouWidth);

                shouGridContainer.style.gridTemplateColumns = `repeat(${shouWidth}, ${cellSize}px)`;
                shouGridContainer.style.gridAutoRows = `${cellSize}px`;
                shouGridContainer.style.width = `${shouWidth * cellSize}px`;
                shouGridContainer.style.height = `${shouHeight * cellSize}px`;
            }
        });
    </script>
</body>
</html>
