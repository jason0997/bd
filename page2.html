<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿæ—¥å¿«ä¹å¹èœ¡çƒ›æ¸¸æˆ</title>
    <!-- å¼•å…¥ Tailwind CSS CDNï¼Œç”¨äºæ ·å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM CDN -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- å¼•å…¥ Babel CDNï¼Œç”¨äºå®æ—¶è½¬è¯‘ JSX -->
    <!-- æ³¨æ„ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåº”è¯¥æå‰ç¼–è¯‘å¥½ JSXï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Babel CDN -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
    <style>
        /* ä¸º Inter å­—ä½“è®¾ç½®ä¸€ä¸ªå›é€€ï¼Œç¡®ä¿åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½æœ‰è‰¯å¥½çš„æ˜¾ç¤º */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* å®šä¹‰åŠ¨ç”»æ•ˆæœï¼Œä¸ React ç»„ä»¶ä¸­çš„ Tailwind ç±»å¯¹åº” */
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-5%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }
        @keyframes bounce-slow {
            0%, 100% {
                transform: translateY(-5%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        .animate-bounce-slow {
            animation: bounce-slow 2s infinite; /* æ…¢é€Ÿå¼¹è·³ */
        }
        .animate-fade-in-up {
            animation: fadeInScale 0.5s ease-out forwards; /* å¼¹çª—æ·¡å…¥æ”¾å¤§æ•ˆæœ */
        }
    </style>
</head>
<body>
    <div id="root"></div> <!-- React åº”ç”¨å°†æŒ‚è½½åˆ°è¿™ä¸ª div ä¸Š -->

    <script type="text/babel">
        // ç²˜è´´æ‚¨ä¹‹å‰è·å¾—çš„ React App ç»„ä»¶ä»£ç åœ¨è¿™é‡Œ
        // æ³¨æ„ï¼šè¿™é‡Œä¸å†ä½¿ç”¨ import è¯­å¥ï¼Œå› ä¸º React å’Œå®ƒçš„ Hooks å·²é€šè¿‡ CDN å…¨å±€å¼•å…¥
        const { useRef, useEffect, useState, useCallback } = React; // ä»å…¨å±€ React å¯¹è±¡è§£æ„ Hooks

        const App = () => {
          const canvasRef = useRef(null); // Canvas å…ƒç´ çš„å¼•ç”¨
          const audioContextRef = useRef(null); // AudioContext çš„å¼•ç”¨ï¼Œç”¨äºå¤„ç†éŸ³é¢‘
          const analyserRef = useRef(null); // AnalyserNode çš„å¼•ç”¨ï¼Œç”¨äºåˆ†æéŸ³é¢‘æ•°æ®
          const micStreamRef = useRef(null); // éº¦å…‹é£åª’ä½“æµçš„å¼•ç”¨
          const animationFrameIdRef = useRef(null); // requestAnimationFrame ID çš„å¼•ç”¨ï¼Œç”¨äºåœæ­¢éŸ³é¢‘åˆ†æå¾ªç¯

          // çŠ¶æ€å˜é‡ï¼Œç”¨äºç®¡ç†æ¸¸æˆé€»è¾‘å’Œ UI
          const [candlesLit, setCandlesLit] = useState(true); // èœ¡çƒ›æ˜¯å¦ç‚¹äº®
          const [message, setMessage] = useState("è¯·å°è¯•å¹ç­èœ¡çƒ›ï¼"); // æ˜¾ç¤ºç»™ç”¨æˆ·çš„ä¿¡æ¯
          const [isMicActive, setIsMicActive] = useState(false); // éº¦å…‹é£æ˜¯å¦æ­£åœ¨ä½¿ç”¨
          const [isGameEnded, setIsGameEnded] = useState(false); // æ¸¸æˆæ˜¯å¦ç»“æŸï¼ˆèœ¡çƒ›å·²å¹ç­ï¼‰
          // å¹æ°”é˜ˆå€¼ï¼šæ­¤å€¼å†³å®šéº¦å…‹é£è¾“å…¥éœ€è¦å¤šå¤§æ‰èƒ½è¢«è¯†åˆ«ä¸ºâ€œå¹æ°”â€ã€‚ç°åœ¨å›ºå®šä¸ºä¸€ä¸ªé»˜è®¤å€¼ã€‚
          const BLOW_THRESHOLD_FIXED = 120; // å°†é˜ˆå€¼å›ºå®šåœ¨ä»£ç ä¸­ï¼Œä¸å†é€šè¿‡UIè°ƒæ•´

          // ç»˜åˆ¶è›‹ç³•å’Œèœ¡çƒ›çš„å¸¸é‡é¢œè‰² - æ›´æ–°ä¸ºæ›´æ¸©é¦¨çš„é¢œè‰²æ–¹æ¡ˆ
          const CAKE_BODY_COLOR = '#F5B041'; // è›‹ç³•ä¸»ä½“é¢œè‰² (æŸ”å’Œçš„å¥¶æ²¹è‰²)
          const CAKE_SHADOW_COLOR = '#C38B27'; // è›‹ç³•é˜´å½±é¢œè‰²
          const ICING_COLOR_TOP = '#FFD700'; // è›‹ç³•é¡¶éƒ¨ç³–éœœ (é‡‘é»„è‰²)
          const ICING_COLOR_MIDDLE = '#FFC300'; // è›‹ç³•ä¸­é—´ç³–éœœ (è¾ƒæ·±çš„é‡‘é»„)
          const CANDLE_COLOR_BASE = '#FF6F61'; // èœ¡çƒ›é¢œè‰² (æŸ”å’Œçš„çŠç‘šçº¢)
          const CANDLE_COLOR_STRIPE = '#FFC0CB'; // èœ¡çƒ›æ¡çº¹ (æ·¡ç²‰è‰²)
          const FLAME_COLOR_INNER = '#FFFF00'; // ç«ç„°å†…å±‚é¢œè‰² (äº®é»„è‰²)
          const FLAME_COLOR_OUTER = '#FF8C00'; // ç«ç„°å¤–å±‚é¢œè‰² (æ·±æ©™è‰²)
          const WICK_COLOR = '#8B4513'; // èœ¡çƒ›èŠ¯é¢œè‰² (éæ£•è‰²)
          const TABLE_COLOR = '#8B4513'; // æ¡Œå­é¢œè‰² (ç”¨äºè›‹ç³•åº•åº§)

          // éŸ³é¢‘æ£€æµ‹å¸¸é‡
          // SAMPLE_SIZE: ç”¨äºå¹æ°”æ£€æµ‹çš„é¢‘ç‡åŒºé—´çš„å¹³å‡æ•°ã€‚è¾ƒå°çš„å€¼å“åº”æ›´å¿«ï¼Œä½†å¯èƒ½ä¸å¤ªå‡†ç¡®ã€‚
          const SAMPLE_SIZE = 128;

          // -------------------- éŸ³é¢‘å¤„ç†å‡½æ•° --------------------

          // åœæ­¢éº¦å…‹é£è¾“å…¥å’ŒéŸ³é¢‘å¤„ç†
          const stopBlowing = useCallback(() => {
            // åœæ­¢éº¦å…‹é£æµä¸­çš„æ‰€æœ‰éŸ³è½¨
            if (micStreamRef.current) {
              micStreamRef.current.getTracks().forEach(track => track.stop());
              micStreamRef.current = null;
            }
            // å…³é—­ AudioContext ä»¥é‡Šæ”¾éŸ³é¢‘èµ„æº
            if (audioContextRef.current) {
              audioContextRef.current.close().catch(e => console.error("å…³é—­ AudioContext é”™è¯¯:", e));
              audioContextRef.current = null;
            }
            // å–æ¶ˆä»»ä½•å¾…å¤„ç†çš„ requestAnimationFrame
            if (animationFrameIdRef.current) {
              cancelAnimationFrame(animationFrameIdRef.current);
              animationFrameIdRef.current = null;
            }
            setIsMicActive(false); // æ›´æ–°çŠ¶æ€ï¼šéº¦å…‹é£ä¸æ´»è·ƒ
          }, []); // æ­¤å‡½æ•°ä¸ä¾èµ–ä»»ä½•çŠ¶æ€æˆ– propsï¼Œæ‰€ä»¥ä¾èµ–æ•°ç»„ä¸ºç©º

          // æŒç»­åˆ†æéº¦å…‹é£éŸ³é¢‘è¾“å…¥
          const analyzeAudio = useCallback(() => {
            // å¦‚æœåˆ†æå™¨ä¸å¯ç”¨ï¼Œæˆ–è€…èœ¡çƒ›å·²ç­ï¼Œæˆ–è€…æ¸¸æˆå·²ç»“æŸï¼Œåˆ™åœæ­¢åˆ†æ
            if (!analyserRef.current || !candlesLit || isGameEnded) {
              animationFrameIdRef.current = null; // æ¸…é™¤åŠ¨ç”»å¸§ ID
              return;
            }

            // ä»åˆ†æå™¨è·å–é¢‘ç‡æ•°æ® (å€¼èŒƒå›´ 0-255)
            const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);
            analyserRef.current.getByteFrequencyData(dataArray);

            // è®¡ç®—éƒ¨åˆ†é¢‘ç‡æ•°æ®çš„å¹³å‡æŒ¯å¹…
            let sum = 0;
            for (let i = 0; i < SAMPLE_SIZE; i++) {
              sum += dataArray[i];
            }
            const average = sum / SAMPLE_SIZE;

            // æ£€æŸ¥å¹³å‡æŒ¯å¹…æ˜¯å¦è¶…è¿‡å¹æ°”é˜ˆå€¼
            if (average > BLOW_THRESHOLD_FIXED) { // ä½¿ç”¨å›ºå®šçš„é˜ˆå€¼
              setCandlesLit(false); // å¹ç­èœ¡çƒ›
              setMessage("ç”Ÿæ—¥å¿«ä¹ï¼"); // æ›´æ–°ä¿¡æ¯
              setIsGameEnded(true); // æ ‡è®°æ¸¸æˆç»“æŸ
              stopBlowing(); // åœæ­¢éº¦å…‹é£å’Œåˆ†æ
            } else {
              // å¦‚æœæœªæ£€æµ‹åˆ°å¹æ°”ï¼Œåˆ™åœ¨ä¸‹ä¸€å¸§ç»§ç»­åˆ†æ
              animationFrameIdRef.current = requestAnimationFrame(analyzeAudio);
            }
          }, [candlesLit, isGameEnded, stopBlowing]); // ä¾èµ–é¡¹ï¼šè¿™äº›çŠ¶æ€å˜åŒ–æ—¶é‡æ–°åˆ›å»ºå‡½æ•°

          // å¼€å§‹è®¿é—®éº¦å…‹é£å¹¶å¼€å§‹éŸ³é¢‘åˆ†æ
          const startBlowing = useCallback(async () => {
            if (isMicActive) return; // å¦‚æœéº¦å…‹é£å·²æ´»è·ƒï¼Œåˆ™ä¸é‡å¤å°è¯•

            try {
              // è¯·æ±‚è®¿é—®ç”¨æˆ·éº¦å…‹é£
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              micStreamRef.current = stream; // å­˜å‚¨æµå¼•ç”¨

              // åˆ›å»º AudioContext (æµè§ˆå™¨éŸ³é¢‘å¤„ç†å›¾)
              const audioContext = new (window.AudioContext || window.webkitAudioContext)();
              audioContextRef.current = audioContext;

              // åˆ›å»º AnalyserNode ä»¥è·å–éŸ³é¢‘æ•°æ®
              const analyser = audioContext.createAnalyser();
              analyser.fftSize = 256; // å¿«é€Ÿå‚…é‡Œå¶å˜æ¢å¤§å° (2 çš„å¹‚)
              analyserRef.current = analyser;

              // ä»éº¦å…‹é£æµåˆ›å»º AudioNode
              const source = audioContext.createMediaStreamSource(stream);
              // å°†éº¦å…‹é£æºè¿æ¥åˆ°åˆ†æå™¨
              source.connect(analyser);

              setIsMicActive(true); // æ›´æ–°çŠ¶æ€ï¼šéº¦å…‹é£æ´»è·ƒ
              setMessage("è¯·å°è¯•å¹ç­èœ¡çƒ›ï¼"); // è®¾ç½®åˆå§‹ä¿¡æ¯
              // å¼€å§‹éŸ³é¢‘åˆ†æå¾ªç¯
              animationFrameIdRef.current = requestAnimationFrame(analyzeAudio);
            } catch (err) {
              // å¤„ç†éº¦å…‹é£è®¿é—®è¢«æ‹’ç»æˆ–ä¸å¯ç”¨çš„é”™è¯¯
              console.error("è®¿é—®éº¦å…‹é£é”™è¯¯:", err);
              setMessage("æ— æ³•è®¿é—®éº¦å…‹é£ã€‚è¯·æ£€æŸ¥æƒé™æˆ–å°è¯•åˆ·æ–°é¡µé¢ã€‚");
              setIsMicActive(false); // æ›´æ–°çŠ¶æ€ï¼šéº¦å…‹é£ä¸æ´»è·ƒ
            }
          }, [isMicActive, analyzeAudio]); // ä¾èµ–é¡¹ï¼šè¿™äº›çŠ¶æ€å˜åŒ–æ—¶é‡æ–°åˆ›å»ºå‡½æ•°

          // -------------------- ç»˜å›¾å‡½æ•° - æ”¹è¿›çš„è›‹ç³•å’Œèœ¡çƒ›æ ·å¼ --------------------

          // ç»˜åˆ¶ç”Ÿæ—¥è›‹ç³•
          const drawCake = useCallback((ctx, width, height) => {
            ctx.clearRect(0, 0, width, height); // ç»˜åˆ¶å‰æ¸…ç©ºæ•´ä¸ªç”»å¸ƒ

            // è®¡ç®—è›‹ç³•å°ºå¯¸ï¼Œä½¿å…¶é€‚åº”å“åº”å¼å¸ƒå±€
            const cakeHeight = height * 0.4;
            const cakeWidth = width * 0.7;
            const cakeX = (width - cakeWidth) / 2;
            const cakeY = height - cakeHeight - 20; // è·ç¦»åº•éƒ¨ 20px

            // ç»˜åˆ¶æ¡Œå­ (è›‹ç³•åº•åº§)
            ctx.fillStyle = TABLE_COLOR;
            ctx.fillRect(0, height - 50, width, 50); // å®½å±æ¡Œå­ï¼Œé«˜ 50px

            // ç»˜åˆ¶è›‹ç³•ä¸»ä½“ (ä¸¤å±‚)
            const layerHeight = cakeHeight / 2;
            // åº•å±‚è›‹ç³•
            ctx.fillStyle = CAKE_BODY_COLOR;
            ctx.beginPath();
            ctx.ellipse(cakeX + cakeWidth / 2, cakeY + cakeHeight / 2 + layerHeight / 2, cakeWidth / 2, layerHeight / 2, 0, Math.PI, 2 * Math.PI, false);
            ctx.rect(cakeX, cakeY + cakeHeight / 2, cakeWidth, layerHeight);
            ctx.closePath();
            ctx.fill();

            // ä¸­é—´ç³–éœœå±‚
            ctx.fillStyle = ICING_COLOR_MIDDLE;
            ctx.beginPath();
            ctx.ellipse(cakeX + cakeWidth / 2, cakeY + cakeHeight / 2, cakeWidth / 2, layerHeight * 0.2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // é¡¶å±‚è›‹ç³•
            const topCakeWidth = cakeWidth * 0.8;
            const topCakeX = cakeX + (cakeWidth - topCakeWidth) / 2;
            const topCakeY = cakeY;
            ctx.fillStyle = CAKE_BODY_COLOR;
            ctx.beginPath();
            ctx.ellipse(topCakeX + topCakeWidth / 2, topCakeY + layerHeight / 2, topCakeWidth / 2, layerHeight / 2, 0, Math.PI, 2 * Math.PI, false);
            ctx.rect(topCakeX, topCakeY, topCakeWidth, layerHeight);
            ctx.closePath();
            ctx.fill();

            // é¡¶éƒ¨ç³–éœœå±‚
            ctx.fillStyle = ICING_COLOR_TOP;
            ctx.beginPath();
            ctx.ellipse(topCakeX + topCakeWidth / 2, topCakeY + layerHeight / 2, topCakeWidth / 2, layerHeight * 0.2, 0, 0, 2 * Math.PI);
            ctx.fill();

            // å¢åŠ è›‹ç³•çš„é˜´å½±å’Œé«˜å…‰æ•ˆæœ
            // é˜´å½±
            ctx.fillStyle = CAKE_SHADOW_COLOR;
            ctx.beginPath();
            ctx.ellipse(cakeX + cakeWidth / 2, cakeY + cakeHeight + 5, cakeWidth / 2, cakeHeight * 0.05, 0, 0, 2 * Math.PI);
            ctx.fill();

            // ç³–éœœè¾¹ç¼˜è£…é¥°ï¼ˆæ³¢æµªçº¿ï¼‰
            ctx.strokeStyle = ICING_COLOR_TOP;
            ctx.lineWidth = 3;
            // é¡¶éƒ¨ç³–éœœè¾¹ç¼˜
            ctx.beginPath();
            for (let i = 0; i <= 20; i++) {
              const x = topCakeX + (topCakeWidth / 20) * i;
              const y = topCakeY + layerHeight / 2 + (i % 2 === 0 ? -5 : 5);
              if (i === 0) ctx.moveTo(x, y);
              else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // ä¸­é—´ç³–éœœè¾¹ç¼˜
            ctx.beginPath();
            for (let i = 0; i <= 20; i++) {
              const x = cakeX + (cakeWidth / 20) * i;
              const y = cakeY + cakeHeight / 2 + (i % 2 === 0 ? -5 : 5);
              if (i === 0) ctx.moveTo(x, y);
              else ctx.lineTo(x, y);
            }
            ctx.stroke();

          }, []);

          // ç»˜åˆ¶èœ¡çƒ› (ç‚¹äº®æˆ–ç†„ç­çŠ¶æ€)
          const drawCandles = useCallback((ctx, lit, width, height) => {
            const cakeWidth = width * 0.7;
            const topCakeWidth = cakeWidth * 0.8;
            const topCakeX = (width - topCakeWidth) / 2;
            const topCakeY = height * 0.6 - 20; // èœ¡çƒ›ä½äºè›‹ç³•é¡¶å±‚ä¸Šæ–¹

            const candleCount = 6; // 60å²ç”Ÿæ—¥ï¼Œç®€å•èµ·è§æ˜¾ç¤º 6 æ”¯èœ¡çƒ›
            const candleWidth = topCakeWidth / (candleCount * 1.5); // è°ƒæ•´èœ¡çƒ›å®½åº¦ä»¥é€‚åº”æ–°çš„è›‹ç³•
            const candleHeight = height * 0.18; // å¢åŠ èœ¡çƒ›é«˜åº¦

            // å¾ªç¯ç»˜åˆ¶æ¯æ”¯èœ¡çƒ›
            for (let i = 0; i < candleCount; i++) {
              const candleX = topCakeX + (i + 0.5) * (topCakeWidth / candleCount) - candleWidth / 2;
              const candleY = topCakeY - candleHeight + 10; // ç¨å¾®å‘ä¸‹è°ƒæ•´ï¼Œè®©èœ¡çƒ›æ’å…¥è›‹ç³•

              // ç»˜åˆ¶èœ¡çƒ›ä¸»ä½“
              ctx.fillStyle = CANDLE_COLOR_BASE;
              ctx.fillRect(candleX, candleY, candleWidth, candleHeight);

              // ç»˜åˆ¶èœ¡çƒ›ä¸Šçš„æ¡çº¹
              ctx.fillStyle = CANDLE_COLOR_STRIPE;
              for (let j = 0; j < 3; j++) {
                ctx.fillRect(candleX, candleY + candleHeight / 4 + j * (candleHeight / 4), candleWidth, candleHeight / 10);
              }

              // ç»˜åˆ¶èœ¡çƒ›èŠ¯
              ctx.fillStyle = WICK_COLOR;
              ctx.fillRect(candleX + candleWidth / 2 - 1, candleY - 5, 2, 8); // èŠ¯çš„ä½ç½®å’Œå¤§å°

              // å¦‚æœèœ¡çƒ›ç‚¹äº®ï¼Œåˆ™ç»˜åˆ¶ç«ç„°
              if (lit) {
                // å¤–å±‚ç«ç„° (æ·±æ©™è‰²ï¼Œè¾ƒå¤§ï¼Œæ›´æ¤­åœ†)
                ctx.beginPath();
                ctx.ellipse(candleX + candleWidth / 2, candleY - 12, candleWidth / 2.5, candleWidth * 0.7, 0, 0, 2 * Math.PI);
                ctx.fillStyle = FLAME_COLOR_OUTER;
                ctx.fill();

                // å†…å±‚ç«ç„° (äº®é»„è‰²ï¼Œè¾ƒå°ï¼Œæ›´æ¤­åœ†)
                ctx.beginPath();
                ctx.ellipse(candleX + candleWidth / 2, candleY - 12, candleWidth / 4, candleWidth * 0.4, 0, 0, 2 * Math.PI);
                ctx.fillStyle = FLAME_COLOR_INNER;
                ctx.fill();
              }
            }
          }, []);

          // ä¸»å‡½æ•°ï¼šç»˜åˆ¶æ•´ä¸ªåœºæ™¯ (è›‹ç³•å’Œèœ¡çƒ›)
          const drawScene = useCallback(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1; // è·å–è®¾å¤‡åƒç´ æ¯”ï¼Œç”¨äºåœ¨é«˜ DPI å±å¹•ä¸Šæ¸…æ™°æ¸²æŸ“
            const rect = canvas.getBoundingClientRect(); // è·å– canvas å…ƒç´ çš„å½“å‰å¤§å°

            // æ ¹æ®æ˜¾ç¤ºå¤§å°å’Œè®¾å¤‡åƒç´ æ¯”è®¾ç½® canvas ç»˜å›¾ç¼“å†²åŒºå¤§å°
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr); // ç¼©æ”¾ä¸Šä¸‹æ–‡ä»¥åŒ¹é…è®¾å¤‡åƒç´ æ¯”

            drawCake(ctx, rect.width, rect.height);
            drawCandles(ctx, candlesLit, rect.width, rect.height);
          }, [drawCake, drawCandles, candlesLit]); // ä¾èµ–é¡¹ï¼šèœ¡çƒ›ç‚¹äº®çŠ¶æ€å˜åŒ–æ—¶é‡æ–°ç»˜åˆ¶

          // -------------------- æ¸¸æˆé€»è¾‘å‡½æ•° --------------------

          // é‡ç½®æ¸¸æˆåˆ°åˆå§‹çŠ¶æ€
          const resetGame = useCallback(() => {
            stopBlowing(); // é‡ç½®å‰ç¡®ä¿éº¦å…‹é£å·²åœæ­¢
            setCandlesLit(true); // é‡æ–°ç‚¹ç‡ƒèœ¡çƒ›
            setMessage("è¯·å°è¯•å¹ç­èœ¡çƒ›ï¼"); // é‡ç½®ä¿¡æ¯
            setIsGameEnded(false); // é‡ç½®æ¸¸æˆç»“æŸçŠ¶æ€
            startBlowing(); // è‡ªåŠ¨é‡æ–°å¼€å§‹éº¦å…‹é£æ£€æµ‹
          }, [stopBlowing, startBlowing]); // ä¾èµ–é¡¹ï¼šè¿™äº›å‡½æ•°å˜åŒ–æ—¶é‡æ–°åˆ›å»ºå‡½æ•°

          // -------------------- å‰¯ä½œç”¨é’©å­ (Effects) --------------------

          // æ•ˆæœé’©å­ï¼šç”¨äºåˆå§‹ç»˜åˆ¶å’Œå¤„ç† canvas å°ºå¯¸å˜åŒ–
          useEffect(() => {
            drawScene(); // ç»„ä»¶æŒ‚è½½æ—¶è¿›è¡Œåˆå§‹ç»˜åˆ¶
            const handleResize = () => drawScene(); // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°ç»˜åˆ¶
            window.addEventListener('resize', handleResize); // æ·»åŠ å°ºå¯¸å˜åŒ–ç›‘å¬å™¨

            // æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æ—¶ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
            return () => window.removeEventListener('resize', handleResize);
          }, [drawScene]); // ä¾èµ–é¡¹ï¼šdrawScene å‡½æ•°å˜åŒ–æ—¶ï¼ˆåœ¨æ­¤å¤„ä¸å¤ªå¯èƒ½ï¼‰é‡æ–°è¿è¡Œæ­¤ effect

          // æ•ˆæœé’©å­ï¼šç®¡ç†éº¦å…‹é£çŠ¶æ€å¹¶åœ¨ç»„ä»¶æŒ‚è½½æˆ–çŠ¶æ€å˜åŒ–æ—¶å¼€å§‹åˆ†æ
          useEffect(() => {
            // ä»…åœ¨æ¸¸æˆæœªç»“æŸã€éº¦å…‹é£ä¸æ´»è·ƒä¸”èœ¡çƒ›ç‚¹äº®æ—¶å¼€å§‹å¹æ°”æ£€æµ‹
            if (!isGameEnded && !isMicActive && candlesLit) {
              startBlowing();
            }
            // æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æˆ–ä¾èµ–é¡¹å˜åŒ–æ—¶ç¡®ä¿éº¦å…‹é£åœæ­¢
            return () => {
              stopBlowing();
            };
          }, [startBlowing, stopBlowing, isMicActive, candlesLit, isGameEnded]); // ä¾èµ–é¡¹

          // æ•ˆæœé’©å­ï¼šæ¯å½“ 'candlesLit' çŠ¶æ€æ”¹å˜æ—¶é‡æ–°ç»˜åˆ¶åœºæ™¯
          useEffect(() => {
            drawScene();
          }, [candlesLit, drawScene]); // ä¾èµ–é¡¹ï¼šcandlesLit æ”¹å˜æ—¶é‡æ–°ç»˜åˆ¶

          return (
            // æ¸¸æˆä¸»å®¹å™¨ï¼Œä½¿ç”¨ Tailwind CSS è¿›è¡Œå“åº”å¼å¸ƒå±€å’Œå±…ä¸­
            <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 p-4 font-inter">
              {/* æ¸¸æˆå†…å®¹å¡ç‰‡ */}
              <div className="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full text-center">
                {/* ç”Ÿæ—¥ç¥ç¦æ ‡é¢˜ */}
                <h1 className="text-4xl font-bold text-gray-800 mb-4 animate-bounce">
                  ç”Ÿæ—¥å¿«ä¹ï¼ğŸ‰
                </h1>

                {/* è›‹ç³•å’Œèœ¡çƒ›çš„ Canvas å®¹å™¨ */}
                <div className="relative w-full max-w-md mx-auto aspect-video mb-6">
                  <canvas
                    ref={canvasRef} // å°† ref èµ‹å€¼ç»™ canvas å…ƒç´ 
                    className="w-full h-full border-4 border-yellow-400 rounded-lg shadow-inner bg-blue-100"
                  ></canvas>
                </div>

                {/* ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ */}
                <p className={`text-xl font-semibold mb-6 ${isGameEnded ? 'text-green-600 animate-pulse' : 'text-gray-700'}`}>
                  {message}
                </p>

                {/* é‡ç½®/é‡æ–°å¼€å§‹æ¸¸æˆæŒ‰é’® */}
                <button
                  onClick={resetGame}
                  className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300"
                >
                  {isGameEnded ? "å†å¹ä¸€æ¬¡ï¼" : "é‡æ–°å¼€å§‹"}
                </button>
              </div>

              {/* æ¡ä»¶æ¸²æŸ“ï¼šâ€œç”Ÿæ—¥å¿«ä¹â€å¼¹çª— */}
              {isGameEnded && (
                <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
                  <div className="bg-yellow-100 p-8 rounded-xl shadow-2xl text-center border-4 border-yellow-500 animate-fade-in-up">
                    <p className="text-5xl font-extrabold text-red-600 mb-6 drop-shadow-lg animate-bounce-slow">
                      ç”Ÿæ—¥å¿«ä¹ï¼
                    </p>
                    <p className="text-3xl font-semibold text-gray-800">
                      ç¥æ‚¨60å²ç”Ÿæ—¥å¿«ä¹ï¼Œå¹¸ç¦å®‰åº·ï¼
                    </p>
                    <button
                      onClick={() => {
                        setIsGameEnded(false); // éšè—å¼¹çª—
                        resetGame(); // é‡ç½®æ¸¸æˆï¼Œä»¥ä¾¿å†ç©ä¸€è½®
                      }}
                      className="mt-8 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-green-300"
                    >
                      å†å¹ä¸€æ¬¡ï¼
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // è·å–æ ¹ DOM å…ƒç´ 
        const domContainer = document.querySelector('#root');
        // åˆ›å»º React æ ¹
        const root = ReactDOM.createRoot(domContainer);
        // æ¸²æŸ“ App ç»„ä»¶åˆ°æ ¹
        root.render(React.createElement(App)); // ä½¿ç”¨ React.createElement æ¥æ¸²æŸ“ App ç»„ä»¶
    </script>
</body>
</html>
